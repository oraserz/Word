<template>
  <div class="page" @swipe="backk">
    <!-- 顶部导航 -->
    <image src="/common/back.png" class="backbtn" style="margin-top: 6px" @click='back'></image>
    <text class="wordshow">{{ word.mean }}</text>
    <!-- 输入显示区域 -->
    <div style="flex:1;flex-direction: column; justify-content: flex-start;align-items: center;width: 100%;padding-left: 3px;padding-right: 3px;" @click="toggleKeyboard">
      <text style="font-size: 28px;font-weight: bold;text-decoration: underline;text-align: center;" >{{ input }}</text>
    </div>
    <image src="/common/next.png" style="position: absolute;bottom: 6px;" @click="next"></image>
    <!-- 键盘区域 -->
    <div class="keyboard-page" show="{{!keyboardHide}}" if="{{keyboardRender}}">
      <div style="background-color:black">
        <div if="{{screentype==='pill-shaped'}}" class="keyboard-container">
          <!-- 键盘布局 -->
          <scroll static id="keyboard66" scroll-x="{{true}}" style="padding: 0 {{paddingHorizontal}}px;">
            <div class="keyboard-rows">
              <div class="keyboard-row row-1">
                <text class="key-btn" for="{{item in keys['full'][0]}}" @click="onKeySelect(item)">{{item}}</text>
              </div>
              <div class="keyboard-row row-2">
                <text class="key-btn" for="{{item in keys['full'][1]}}" @click="onKeySelect(item)">{{item}}</text>
              </div>
              <div class="keyboard-row row-3">
                <text class="key-btn" for="{{item in keys['full'][2]}}" @click="onKeySelect(item)">{{item}}</text>
                <img src="/common/arc/space.png" class="space-btn" @click="onSpaceClick" />
              </div>
            </div>
          </scroll>
          <!-- 控制栏 -->
          <div class="control-bar">
            <img src="/common/arc/bigA.png" class="case-btn" @click="onCaseToggle" show="{{upperFlag}}" />
            <img src="/common/arc/a.png" class="case-btn" @click="onCaseToggle" show="{{!upperFlag}}" />
            <img static src="/common/arc/del.png" class="delete-btn" @click="onDeleteClick" />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import vibrator from "@system.vibrator";
import router from "@system.router"
export default {
  data: {
    word: {},
    currentIndex: 0,
    keyboardRender: false,
    keyboardHide: true,
    input: "  ",
    isFirstInput: true,
    textcolor: white,
    upperFlag: false,
    screenWidth: 192, // 硬编码屏幕宽度
    paddingHorizontal: 0, // 硬编码为0，不需要计算
    screentype: "pill-shaped",
    keys: {
      full: [
        ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
        ["A", "S", "D", "F", "G", "H", "J", "K", "L"],
        ["Z", "X", "C", "V", "B", "N", "M"],
      ]
    },
  },
  
  onInit() {
    this.word = this.$app.$def.fuckArray[0]
    // 删除了设备判断和屏幕宽度调整逻辑
  },
  onReady(){
  this.keyboardRender = true;
  },
  // 键盘相关方法
  onKeySelect(key) {
    this.vibrate();
    const textToAdd = this.upperFlag ? key.toUpperCase() : key.toLowerCase();
    
    // 如果是第一次输入，清空input中的空格
    if (this.isFirstInput) {
      this.input = textToAdd;
      this.isFirstInput = false;
    } else {
      this.input += textToAdd;
    }
  },
  
  onDeleteClick() {
    this.vibrate();
    
    // 当有两个空格时，删除键无操作
    if (this.input === "  ") {
      return;
    }
    
    if (this.input.length > 0) {
      this.input = this.input.slice(0, -1);
      if (this.input.length === 0) {
        this.input = "  ";
        this.isFirstInput = true;
      }
    }
  },
  
  onSpaceClick() {
    this.vibrate();
    this.input += " ";
  },
  
  onCaseToggle() {
    this.vibrate();
    this.upperFlag = !this.upperFlag;
  },
  
  vibrate() {
    vibrator.vibrate({ mode: 'short' });
  },
  
  // 删除了adjustScreenWidth方法
  
  // 页面相关方法
  /*toggleKeyboard() {
  if (!this.keyboardRender) {
    // 第一次点击：显示并渲染键盘
    this.keyboardRender = true;
    this.keyboardHide = false;
  } else {
    // 后续点击：仅切换隐藏状态，不重新渲染
    this.keyboardHide = !this.keyboardHide;
  }
},*/
  toggleKeyboard() {
  this.keyboardHide = !this.keyboardHide;
  // 如果需要确保键盘已渲染，可以在onInit中设置keyboardRender为true
  },
  
  back() {
    this.keyboardHide = true;
  },
  
  backk(eve) {
  if (eve.direction === 'right') {
    // 方法1: 使用back方法返回到指定页面
    router.back({
      path: '/pages/index'
    })
  }
},
  
  next() {
    if (this.$app.$def.fuckArray.length > this.currentIndex + 1) {
      this.currentIndex = this.currentIndex + 1
      this.word = this.$app.$def.fuckArray[this.currentIndex]
    } else {
      console.log("听写")
      router.replace({
        uri: "/pages/spell"
      })
    }
  }  
}
</script>
<style>
.page {
  width: 192px;
  height: 490px;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}
.wordshow {
  position: relative;
  left: 0;
  width: 186px;
  font-size: 22px;
  color: white;
  margin-top: 20px;
  text-overflow: ellipsis;
  lines: 2;
  text-align: center;
}
/* 键盘样式 */
.keyboard-page {
  width: 100%;
  position: absolute;
  left: 0;
  bottom: 0;
}
.keyboard-container {
  width: 100%;
  height: 245px;
  position: relative;
}
#keyboard66 {
  position: absolute;
  left: 0;
  top: 60px;
  width: 100%;
  height: 170px;
}
.keyboard-rows {
  flex-direction: column;
  left: 3px;
}
.keyboard-row {
  flex-direction: row;
  height: 60px;
}
.row-1 {
  margin-left: 0;
  margin-top: 0;
}
.row-2 {
  margin-left: 32px;
  margin-top: -5px;
}
.row-3 {
  margin-left: 64px;
  margin-top: -5px;
}
.key-btn {
  color: rgb(255, 255, 255);
  font-size: 32px;
  font-weight: bold;
  background-color: rgb(38, 38, 38);
  margin-right: 3px;
  width: 60px;
  height: 60px;
  border-radius: 30px;
  text-align: center;
  border: 3px solid rgba(255, 255, 255, 0.06);
}
.space-btn {
  width: 60px;
  height: 60px;
}
.control-bar {
  position: absolute;
  left: 50%;
  top: 0;
  width: 192px;
  height: 60px;
  margin-left: -96px;
}
.case-btn {
  position: absolute;
  top: 0;
  left: 72px;
  width: 48px;
  height: 42px;
}
.delete-btn {
  position: absolute;
  left: 135px;
  top: 0;
  width: 48px;
  height: 42px;
}
</style>
